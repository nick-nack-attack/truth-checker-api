function cov_rmxxz5u4x(){var path="/Users/nickfarni/WebstormProjects/truth-checker-api/src/middleware/jwt-auth.js";var hash="fa65e85895e98f41a342066b7a9e9ce7a65f2732";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/nickfarni/WebstormProjects/truth-checker-api/src/middleware/jwt-auth.js",statementMap:{"0":{start:{line:2,column:20},end:{line:2,column:51}},"1":{start:{line:5,column:22},end:{line:5,column:52}},"2":{start:{line:8,column:4},end:{line:17,column:5}},"3":{start:{line:9,column:12},end:{line:13,column:14}},"4":{start:{line:16,column:8},end:{line:16,column:58}},"5":{start:{line:19,column:4},end:{line:46,column:5}},"6":{start:{line:20,column:24},end:{line:20,column:58}},"7":{start:{line:21,column:8},end:{line:38,column:15}},"8":{start:{line:23,column:16},end:{line:31,column:17}},"9":{start:{line:24,column:20},end:{line:30,column:22}},"10":{start:{line:32,column:16},end:{line:32,column:32}},"11":{start:{line:33,column:16},end:{line:33,column:23}},"12":{start:{line:36,column:16},end:{line:36,column:33}},"13":{start:{line:37,column:16},end:{line:37,column:26}},"14":{start:{line:41,column:8},end:{line:45,column:14}},"15":{start:{line:49,column:0},end:{line:49,column:33}}},fnMap:{"0":{name:"requireAuth",decl:{start:{line:4,column:9},end:{line:4,column:20}},loc:{start:{line:4,column:37},end:{line:47,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:22,column:18},end:{line:22,column:19}},loc:{start:{line:22,column:26},end:{line:34,column:13}},line:22},"2":{name:"(anonymous_2)",decl:{start:{line:35,column:19},end:{line:35,column:20}},loc:{start:{line:35,column:26},end:{line:38,column:13}},line:35}},branchMap:{"0":{loc:{start:{line:5,column:22},end:{line:5,column:52}},type:"binary-expr",locations:[{start:{line:5,column:22},end:{line:5,column:46}},{start:{line:5,column:50},end:{line:5,column:52}}],line:5},"1":{loc:{start:{line:8,column:4},end:{line:17,column:5}},type:"if",locations:[{start:{line:8,column:4},end:{line:17,column:5}},{start:{line:8,column:4},end:{line:17,column:5}}],line:8},"2":{loc:{start:{line:23,column:16},end:{line:31,column:17}},type:"if",locations:[{start:{line:23,column:16},end:{line:31,column:17}},{start:{line:23,column:16},end:{line:31,column:17}}],line:23}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"fa65e85895e98f41a342066b7a9e9ce7a65f2732"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_rmxxz5u4x=function(){return actualCoverage;};}return actualCoverage;}cov_rmxxz5u4x();// JWT Authentication
const AuthService=(cov_rmxxz5u4x().s[0]++,require('../auth/auth-service'));function requireAuth(req,res,next){cov_rmxxz5u4x().f[0]++;const authToken=(cov_rmxxz5u4x().s[1]++,(cov_rmxxz5u4x().b[0][0]++,req.get('Authorization'))||(cov_rmxxz5u4x().b[0][1]++,''));let bearerToken;cov_rmxxz5u4x().s[2]++;if(!authToken.toLowerCase().startsWith('bearer ')){cov_rmxxz5u4x().b[1][0]++;cov_rmxxz5u4x().s[3]++;return res.status(401).json({error:'Missing bearer token'});}else{cov_rmxxz5u4x().b[1][1]++;cov_rmxxz5u4x().s[4]++;// slice off 'bearer ' from the token
bearerToken=authToken.slice(7,authToken.length);}cov_rmxxz5u4x().s[5]++;try{const payload=(cov_rmxxz5u4x().s[6]++,AuthService.verifyJwt(bearerToken));cov_rmxxz5u4x().s[7]++;AuthService.getUserWithEmail(payload.sub).then(user=>{cov_rmxxz5u4x().f[1]++;cov_rmxxz5u4x().s[8]++;if(!user){cov_rmxxz5u4x().b[2][0]++;cov_rmxxz5u4x().s[9]++;return res.status(401).json({error:'Unauthorized request'});}else{cov_rmxxz5u4x().b[2][1]++;}cov_rmxxz5u4x().s[10]++;req.user=user;cov_rmxxz5u4x().s[11]++;next();}).catch(err=>{cov_rmxxz5u4x().f[2]++;cov_rmxxz5u4x().s[12]++;console.log(err);cov_rmxxz5u4x().s[13]++;next(err);});}catch(error){cov_rmxxz5u4x().s[14]++;res.status(401).json({error:'Unauthorized request'});}}cov_rmxxz5u4x().s[15]++;module.exports={requireAuth};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImp3dC1hdXRoLmpzIl0sIm5hbWVzIjpbIkF1dGhTZXJ2aWNlIiwicmVxdWlyZSIsInJlcXVpcmVBdXRoIiwicmVxIiwicmVzIiwibmV4dCIsImF1dGhUb2tlbiIsImdldCIsImJlYXJlclRva2VuIiwidG9Mb3dlckNhc2UiLCJzdGFydHNXaXRoIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwic2xpY2UiLCJsZW5ndGgiLCJwYXlsb2FkIiwidmVyaWZ5Snd0IiwiZ2V0VXNlcldpdGhFbWFpbCIsInN1YiIsInRoZW4iLCJ1c2VyIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IjJvRkFlWTt5RkFmWjtBQUNBLEtBQU1BLENBQUFBLFdBQVcseUJBQUdDLE9BQU8sQ0FBQyxzQkFBRCxDQUFWLENBQWpCLENBRUEsUUFBU0MsQ0FBQUEsV0FBVCxDQUFxQkMsR0FBckIsQ0FBMEJDLEdBQTFCLENBQStCQyxJQUEvQixDQUFxQyx3QkFDakMsS0FBTUMsQ0FBQUEsU0FBUyx5QkFBRywyQkFBQUgsR0FBRyxDQUFDSSxHQUFKLENBQVEsZUFBUiwrQkFBNEIsRUFBNUIsQ0FBSCxDQUFmLENBQ0EsR0FBSUMsQ0FBQUEsV0FBSixDQUZpQyx1QkFJakMsR0FBSSxDQUFDRixTQUFTLENBQUNHLFdBQVYsR0FBd0JDLFVBQXhCLENBQW1DLFNBQW5DLENBQUwsQ0FBb0Qsa0RBQzVDLE1BQ0lOLENBQUFBLEdBQUcsQ0FDRU8sTUFETCxDQUNZLEdBRFosRUFFS0MsSUFGTCxDQUVVLENBQUVDLEtBQUssQ0FBRSxzQkFBVCxDQUZWLENBREosQ0FLSCxDQU5MLElBTVcsa0RBQ1A7QUFDQUwsV0FBVyxDQUFHRixTQUFTLENBQUNRLEtBQVYsQ0FBZ0IsQ0FBaEIsQ0FBbUJSLFNBQVMsQ0FBQ1MsTUFBN0IsQ0FBZCxDQUNILENBYmdDLHVCQWVqQyxHQUFJLENBQ0EsS0FBTUMsQ0FBQUEsT0FBTyx5QkFBR2hCLFdBQVcsQ0FBQ2lCLFNBQVosQ0FBc0JULFdBQXRCLENBQUgsQ0FBYixDQURBLHVCQUVBUixXQUFXLENBQUNrQixnQkFBWixDQUE2QkYsT0FBTyxDQUFDRyxHQUFyQyxFQUNLQyxJQURMLENBQ1VDLElBQUksRUFBSSwrQ0FDVixHQUFHLENBQUNBLElBQUosQ0FBVSxrREFDTixNQUNJakIsQ0FBQUEsR0FBRyxDQUNFTyxNQURMLENBQ1ksR0FEWixFQUVLQyxJQUZMLENBRVUsQ0FDRkMsS0FBSyxDQUFFLHNCQURMLENBRlYsQ0FESixDQU9ILENBUkQsZ0NBRFUsd0JBVVZWLEdBQUcsQ0FBQ2tCLElBQUosQ0FBV0EsSUFBWCxDQVZVLHdCQVdWaEIsSUFBSSxHQUNQLENBYkwsRUFjS2lCLEtBZEwsQ0FjV0MsR0FBRyxFQUFJLGdEQUNWQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUYsR0FBWixFQURVLHdCQUVWbEIsSUFBSSxDQUFDa0IsR0FBRCxDQUFKLENBQ0gsQ0FqQkwsRUFrQkMsQ0FDTCxNQUFPVixLQUFQLENBQWMseUJBQ1ZULEdBQUcsQ0FDRU8sTUFETCxDQUNZLEdBRFosRUFFS0MsSUFGTCxDQUVVLENBQ0ZDLEtBQUssQ0FBRSxzQkFETCxDQUZWLEVBS0gsQ0FDSixDLHdCQUVEYSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBRXpCLFdBQUYsQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBKV1QgQXV0aGVudGljYXRpb25cbmNvbnN0IEF1dGhTZXJ2aWNlID0gcmVxdWlyZSgnLi4vYXV0aC9hdXRoLXNlcnZpY2UnKTtcblxuZnVuY3Rpb24gcmVxdWlyZUF1dGgocmVxLCByZXMsIG5leHQpIHtcbiAgICBjb25zdCBhdXRoVG9rZW4gPSByZXEuZ2V0KCdBdXRob3JpemF0aW9uJykgfHwgJydcbiAgICBsZXQgYmVhcmVyVG9rZW47XG5cbiAgICBpZiAoIWF1dGhUb2tlbi50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoJ2JlYXJlciAnKSkge1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICByZXNcbiAgICAgICAgICAgICAgICAgICAgLnN0YXR1cyg0MDEpXG4gICAgICAgICAgICAgICAgICAgIC5qc29uKHsgZXJyb3I6ICdNaXNzaW5nIGJlYXJlciB0b2tlbicgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHNsaWNlIG9mZiAnYmVhcmVyICcgZnJvbSB0aGUgdG9rZW5cbiAgICAgICAgYmVhcmVyVG9rZW4gPSBhdXRoVG9rZW4uc2xpY2UoNywgYXV0aFRva2VuLmxlbmd0aClcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXlsb2FkID0gQXV0aFNlcnZpY2UudmVyaWZ5Snd0KGJlYXJlclRva2VuKTtcbiAgICAgICAgQXV0aFNlcnZpY2UuZ2V0VXNlcldpdGhFbWFpbChwYXlsb2FkLnN1YilcbiAgICAgICAgICAgIC50aGVuKHVzZXIgPT4ge1xuICAgICAgICAgICAgICAgIGlmKCF1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoIFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0YXR1cyg0MDEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmpzb24oeyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6ICdVbmF1dGhvcml6ZWQgcmVxdWVzdCcgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVxLnVzZXIgPSB1c2VyO1xuICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgIG5leHQoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJlc1xuICAgICAgICAgICAgLnN0YXR1cyg0MDEpXG4gICAgICAgICAgICAuanNvbih7IFxuICAgICAgICAgICAgICAgIGVycm9yOiAnVW5hdXRob3JpemVkIHJlcXVlc3QnIFxuICAgICAgICAgICAgfSlcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0geyByZXF1aXJlQXV0aCB9OyJdfQ==
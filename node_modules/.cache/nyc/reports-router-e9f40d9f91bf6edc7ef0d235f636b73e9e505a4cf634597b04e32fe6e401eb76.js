function cov_1zvevtmd0u(){var path="/Users/nickfarni/WebstormProjects/truth-checker-api/src/reports/reports-router.js";var hash="e652c77870b763a05ac595dd3a18154463afb456";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/nickfarni/WebstormProjects/truth-checker-api/src/reports/reports-router.js",statementMap:{"0":{start:{line:2,column:30},end:{line:2,column:48}},"1":{start:{line:3,column:30},end:{line:3,column:38}},"2":{start:{line:4,column:30},end:{line:4,column:36}},"3":{start:{line:5,column:30},end:{line:5,column:45}},"4":{start:{line:8,column:30},end:{line:8,column:58}},"5":{start:{line:9,column:30},end:{line:9,column:63}},"6":{start:{line:10,column:30},end:{line:10,column:70}},"7":{start:{line:14,column:0},end:{line:64,column:6}},"8":{start:{line:17,column:8},end:{line:22,column:28}},"9":{start:{line:20,column:20},end:{line:20,column:70}},"10":{start:{line:26,column:28},end:{line:26,column:36}},"11":{start:{line:27,column:26},end:{line:30,column:9}},"12":{start:{line:32,column:8},end:{line:62,column:27}},"13":{start:{line:32,column:14},end:{line:61,column:18}},"14":{start:{line:35,column:20},end:{line:53,column:18}},"15":{start:{line:38,column:28},end:{line:43,column:29}},"16":{start:{line:46,column:20},end:{line:52,column:21}},"17":{start:{line:56,column:20},end:{line:60,column:26}},"18":{start:{line:62,column:18},end:{line:62,column:25}},"19":{start:{line:66,column:0},end:{line:100,column:7}},"20":{start:{line:70,column:25},end:{line:70,column:45}},"21":{start:{line:71,column:8},end:{line:76,column:28}},"22":{start:{line:74,column:20},end:{line:74,column:36}},"23":{start:{line:79,column:34},end:{line:79,column:42}},"24":{start:{line:80,column:31},end:{line:80,column:48}},"25":{start:{line:81,column:25},end:{line:81,column:45}},"26":{start:{line:83,column:8},end:{line:98,column:32}},"27":{start:{line:83,column:14},end:{line:97,column:18}},"28":{start:{line:89,column:20},end:{line:89,column:55}},"29":{start:{line:92,column:20},end:{line:96,column:26}},"30":{start:{line:98,column:23},end:{line:98,column:30}},"31":{start:{line:102,column:0},end:{line:102,column:31}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:16,column:9},end:{line:16,column:10}},loc:{start:{line:16,column:29},end:{line:24,column:5}},line:16},"1":{name:"(anonymous_1)",decl:{start:{line:19,column:22},end:{line:19,column:23}},loc:{start:{line:19,column:32},end:{line:21,column:17}},line:19},"2":{name:"(anonymous_2)",decl:{start:{line:25,column:26},end:{line:25,column:27}},loc:{start:{line:25,column:46},end:{line:64,column:5}},line:25},"3":{name:"(anonymous_3)",decl:{start:{line:34,column:22},end:{line:34,column:23}},loc:{start:{line:34,column:28},end:{line:54,column:13}},line:34},"4":{name:"(anonymous_4)",decl:{start:{line:37,column:30},end:{line:37,column:31}},loc:{start:{line:37,column:47},end:{line:44,column:25}},line:37},"5":{name:"(anonymous_5)",decl:{start:{line:45,column:23},end:{line:45,column:24}},loc:{start:{line:45,column:29},end:{line:53,column:17}},line:45},"6":{name:"(anonymous_6)",decl:{start:{line:55,column:23},end:{line:55,column:24}},loc:{start:{line:55,column:30},end:{line:61,column:17}},line:55},"7":{name:"(anonymous_7)",decl:{start:{line:69,column:9},end:{line:69,column:10}},loc:{start:{line:69,column:29},end:{line:77,column:5}},line:69},"8":{name:"(anonymous_8)",decl:{start:{line:73,column:22},end:{line:73,column:23}},loc:{start:{line:73,column:32},end:{line:75,column:17}},line:73},"9":{name:"(anonymous_9)",decl:{start:{line:78,column:27},end:{line:78,column:28}},loc:{start:{line:78,column:47},end:{line:100,column:5}},line:78},"10":{name:"(anonymous_10)",decl:{start:{line:88,column:22},end:{line:88,column:23}},loc:{start:{line:88,column:32},end:{line:90,column:17}},line:88},"11":{name:"(anonymous_11)",decl:{start:{line:91,column:23},end:{line:91,column:24}},loc:{start:{line:91,column:29},end:{line:97,column:17}},line:91}},branchMap:{},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"e652c77870b763a05ac595dd3a18154463afb456"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1zvevtmd0u=function(){return actualCoverage;};}return actualCoverage;}cov_1zvevtmd0u();// Reports router
const{Router,json}=(cov_1zvevtmd0u().s[0]++,require('express'));const ReportsRouter=(cov_1zvevtmd0u().s[1]++,Router());const jsonBodyParser=(cov_1zvevtmd0u().s[2]++,json());const path=(cov_1zvevtmd0u().s[3]++,require('path'));// services
const ReportsService=(cov_1zvevtmd0u().s[4]++,require('./reports-service'));const FactsService=(cov_1zvevtmd0u().s[5]++,require('../facts/facts-service'));const{checkReportExists}=(cov_1zvevtmd0u().s[6]++,require('../middleware/check-if-exists'));// omitting auth middleware for initial mvp release
cov_1zvevtmd0u().s[7]++;ReportsRouter.route('/').get((req,res,next)=>{cov_1zvevtmd0u().f[0]++;cov_1zvevtmd0u().s[8]++;ReportsService.getReports().then(report=>{cov_1zvevtmd0u().f[1]++;cov_1zvevtmd0u().s[9]++;res.json(ReportsService.removeDupesReduce(report));}).catch(next);}).post(jsonBodyParser,(req,res,next)=>{cov_1zvevtmd0u().f[2]++;const{fact_id}=(cov_1zvevtmd0u().s[10]++,req.body);const newReport=(cov_1zvevtmd0u().s[11]++,{fact_id:fact_id,report_status:'Processing'});cov_1zvevtmd0u().s[12]++;try{cov_1zvevtmd0u().s[13]++;FactsService.getFactById(newReport.fact_id).then(()=>{cov_1zvevtmd0u().f[3]++;cov_1zvevtmd0u().s[14]++;ReportsService.insertReport(newReport).then(createdReport=>{cov_1zvevtmd0u().f[4]++;cov_1zvevtmd0u().s[15]++;return res.status(201).location((path.posix.join(req.originalUrl),`/id/${createdReport.report_id}`)).json(createdReport);}).catch(()=>{cov_1zvevtmd0u().f[5]++;cov_1zvevtmd0u().s[16]++;return res.status(404).json({error:`Fact doesn't exist`});});}).catch(err=>{cov_1zvevtmd0u().f[6]++;cov_1zvevtmd0u().s[17]++;return res.status(400).json({error:`Must include fact_id as integer`});});}catch{cov_1zvevtmd0u().s[18]++;next();}});cov_1zvevtmd0u().s[19]++;ReportsRouter.route('/id/:report_id').all(checkReportExists).get((req,res,next)=>{cov_1zvevtmd0u().f[7]++;const reportId=(cov_1zvevtmd0u().s[20]++,req.params.report_id);cov_1zvevtmd0u().s[21]++;ReportsService.getReportById(reportId).then(report=>{cov_1zvevtmd0u().f[8]++;cov_1zvevtmd0u().s[22]++;res.json(report);}).catch(next);}).patch(jsonBodyParser,(req,res,next)=>{cov_1zvevtmd0u().f[9]++;const{report_status}=(cov_1zvevtmd0u().s[23]++,req.body);const reportToUpdate=(cov_1zvevtmd0u().s[24]++,{report_status});const reportId=(cov_1zvevtmd0u().s[25]++,req.params.report_id);cov_1zvevtmd0u().s[26]++;try{cov_1zvevtmd0u().s[27]++;ReportsService.updateReport(reportId,reportToUpdate).then(report=>{cov_1zvevtmd0u().f[10]++;cov_1zvevtmd0u().s[28]++;return res.status(201).json(report);}).catch(()=>{cov_1zvevtmd0u().f[11]++;cov_1zvevtmd0u().s[29]++;return res.status(400).json({error:`Request body must include report_status 'Processing', 'Approved', or 'Denied'`});});}catch(err){cov_1zvevtmd0u().s[30]++;next();}});cov_1zvevtmd0u().s[31]++;module.exports=ReportsRouter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlcG9ydHMtcm91dGVyLmpzIl0sIm5hbWVzIjpbIlJvdXRlciIsImpzb24iLCJyZXF1aXJlIiwiUmVwb3J0c1JvdXRlciIsImpzb25Cb2R5UGFyc2VyIiwicGF0aCIsIlJlcG9ydHNTZXJ2aWNlIiwiRmFjdHNTZXJ2aWNlIiwiY2hlY2tSZXBvcnRFeGlzdHMiLCJyb3V0ZSIsImdldCIsInJlcSIsInJlcyIsIm5leHQiLCJnZXRSZXBvcnRzIiwidGhlbiIsInJlcG9ydCIsInJlbW92ZUR1cGVzUmVkdWNlIiwiY2F0Y2giLCJwb3N0IiwiZmFjdF9pZCIsImJvZHkiLCJuZXdSZXBvcnQiLCJyZXBvcnRfc3RhdHVzIiwiZ2V0RmFjdEJ5SWQiLCJpbnNlcnRSZXBvcnQiLCJjcmVhdGVkUmVwb3J0Iiwic3RhdHVzIiwibG9jYXRpb24iLCJwb3NpeCIsImpvaW4iLCJvcmlnaW5hbFVybCIsInJlcG9ydF9pZCIsImVycm9yIiwiZXJyIiwiYWxsIiwicmVwb3J0SWQiLCJwYXJhbXMiLCJnZXRSZXBvcnRCeUlkIiwicGF0Y2giLCJyZXBvcnRUb1VwZGF0ZSIsInVwZGF0ZVJlcG9ydCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJnNklBZVk7MkZBZlo7QUFDQSxLQUFNLENBQUVBLE1BQUYsQ0FBVUMsSUFBViwyQkFBd0JDLE9BQU8sQ0FBQyxTQUFELENBQS9CLENBQU4sQ0FDQSxLQUFNQyxDQUFBQSxhQUFhLDBCQUFXSCxNQUFNLEVBQWpCLENBQW5CLENBQ0EsS0FBTUksQ0FBQUEsY0FBYywwQkFBVUgsSUFBSSxFQUFkLENBQXBCLENBQ0EsS0FBTUksQ0FBQUEsSUFBSSwwQkFBb0JILE9BQU8sQ0FBQyxNQUFELENBQTNCLENBQVYsQ0FFQTtBQUNBLEtBQU1JLENBQUFBLGNBQWMsMEJBQVVKLE9BQU8sQ0FBQyxtQkFBRCxDQUFqQixDQUFwQixDQUNBLEtBQU1LLENBQUFBLFlBQVksMEJBQVlMLE9BQU8sQ0FBQyx3QkFBRCxDQUFuQixDQUFsQixDQUNBLEtBQU0sQ0FBRU0saUJBQUYsMkJBQXdCTixPQUFPLENBQUMsK0JBQUQsQ0FBL0IsQ0FBTixDQUVBO3dCQUVBQyxhQUFhLENBQ1JNLEtBREwsQ0FDVyxHQURYLEVBRUtDLEdBRkwsQ0FFUyxDQUFDQyxHQUFELENBQU1DLEdBQU4sQ0FBV0MsSUFBWCxHQUFvQixpREFDckJQLGNBQWMsQ0FDVFEsVUFETCxHQUVTQyxJQUZULENBRWNDLE1BQU0sRUFBSSxpREFDWkosR0FBRyxDQUFDWCxJQUFKLENBQVNLLGNBQWMsQ0FBQ1csaUJBQWYsQ0FBaUNELE1BQWpDLENBQVQsRUFDSCxDQUpULEVBS1NFLEtBTFQsQ0FLZUwsSUFMZixFQU9ILENBVkwsRUFXS00sSUFYTCxDQVdVZixjQVhWLENBVzBCLENBQUNPLEdBQUQsQ0FBTUMsR0FBTixDQUFXQyxJQUFYLEdBQW9CLHlCQUN0QyxLQUFNLENBQUVPLE9BQUYsNEJBQWNULEdBQUcsQ0FBQ1UsSUFBbEIsQ0FBTixDQUNBLEtBQU1DLENBQUFBLFNBQVMsMkJBQUcsQ0FDZEYsT0FBTyxDQUFFQSxPQURLLENBRWRHLGFBQWEsQ0FBRSxZQUZELENBQUgsQ0FBZixDQUZzQyx5QkFPdEMsR0FBSSwwQkFBRWhCLFlBQVksQ0FDYmlCLFdBREMsQ0FDV0YsU0FBUyxDQUFDRixPQURyQixFQUVHTCxJQUZILENBRVEsSUFBTSxrREFDUlQsY0FBYyxDQUNUbUIsWUFETCxDQUNrQkgsU0FEbEIsRUFFS1AsSUFGTCxDQUVVVyxhQUFhLEVBQUksa0RBQ25CLE1BQ0lkLENBQUFBLEdBQUcsQ0FDRWUsTUFETCxDQUNZLEdBRFosRUFFS0MsUUFGTCxFQUVnQnZCLElBQUksQ0FBQ3dCLEtBQUwsQ0FBV0MsSUFBWCxDQUFnQm5CLEdBQUcsQ0FBQ29CLFdBQXBCLEVBQW1DLE9BQU1MLGFBQWEsQ0FBQ00sU0FBVSxFQUZqRixHQUdLL0IsSUFITCxDQUdVeUIsYUFIVixDQURKLENBTUgsQ0FUTCxFQVVIUixLQVZHLENBVUcsSUFBTSxrREFDVCxNQUNJTixDQUFBQSxHQUFHLENBQ0VlLE1BREwsQ0FDWSxHQURaLEVBRUsxQixJQUZMLENBRVUsQ0FDRmdDLEtBQUssQ0FBRyxvQkFETixDQUZWLENBREosQ0FPSCxDQWxCRyxFQW1CUCxDQXRCQyxFQXVCR2YsS0F2QkgsQ0F1QlNnQixHQUFHLEVBQUksa0RBQ1YsTUFBT3RCLENBQUFBLEdBQUcsQ0FDTGUsTUFERSxDQUNLLEdBREwsRUFFRjFCLElBRkUsQ0FFRyxDQUNGZ0MsS0FBSyxDQUFHLGlDQUROLENBRkgsQ0FBUCxDQUtILENBN0JILEVBOEJMLENBQUMsS0FBTSwwQkFBRXBCLElBQUksR0FBSyxDQUV0QixDQWxETCxFLHlCQW9EQVYsYUFBYSxDQUNSTSxLQURMLENBQ1csZ0JBRFgsRUFFSzBCLEdBRkwsQ0FFUzNCLGlCQUZULEVBR0tFLEdBSEwsQ0FHUyxDQUFDQyxHQUFELENBQU1DLEdBQU4sQ0FBV0MsSUFBWCxHQUFvQix5QkFDckIsS0FBTXVCLENBQUFBLFFBQVEsMkJBQUd6QixHQUFHLENBQUMwQixNQUFKLENBQVdMLFNBQWQsQ0FBZCxDQURxQix5QkFFckIxQixjQUFjLENBQ1RnQyxhQURMLENBQ21CRixRQURuQixFQUVTckIsSUFGVCxDQUVjQyxNQUFNLEVBQUksa0RBQ1pKLEdBQUcsQ0FBQ1gsSUFBSixDQUFTZSxNQUFULEVBQ0gsQ0FKVCxFQUtTRSxLQUxULENBS2VMLElBTGYsRUFNSCxDQVhMLEVBWUswQixLQVpMLENBWVduQyxjQVpYLENBWTJCLENBQUNPLEdBQUQsQ0FBTUMsR0FBTixDQUFXQyxJQUFYLEdBQW9CLHlCQUN2QyxLQUFNLENBQUVVLGFBQUYsNEJBQW9CWixHQUFHLENBQUNVLElBQXhCLENBQU4sQ0FDQSxLQUFNbUIsQ0FBQUEsY0FBYywyQkFBRyxDQUFFakIsYUFBRixDQUFILENBQXBCLENBQ0EsS0FBTWEsQ0FBQUEsUUFBUSwyQkFBR3pCLEdBQUcsQ0FBQzBCLE1BQUosQ0FBV0wsU0FBZCxDQUFkLENBSHVDLHlCQUt2QyxHQUFJLDBCQUFFMUIsY0FBYyxDQUNmbUMsWUFEQyxDQUVFTCxRQUZGLENBR0VJLGNBSEYsRUFLR3pCLElBTEgsQ0FLUUMsTUFBTSxFQUFJLG1EQUNaLE1BQU9KLENBQUFBLEdBQUcsQ0FBQ2UsTUFBSixDQUFXLEdBQVgsRUFBZ0IxQixJQUFoQixDQUFxQmUsTUFBckIsQ0FBUCxDQUNILENBUEgsRUFRR0UsS0FSSCxDQVFTLElBQU0sbURBQ1QsTUFBT04sQ0FBQUEsR0FBRyxDQUNMZSxNQURFLENBQ0ssR0FETCxFQUVGMUIsSUFGRSxDQUVHLENBQ0ZnQyxLQUFLLENBQUcsK0VBRE4sQ0FGSCxDQUFQLENBS0gsQ0FkSCxFQWVMLENBQUMsTUFBTUMsR0FBTixDQUFXLDBCQUFFckIsSUFBSSxHQUFLLENBRTNCLENBbENMLEUseUJBb0NBNkIsTUFBTSxDQUFDQyxPQUFQLENBQWlCeEMsYUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBSZXBvcnRzIHJvdXRlclxuY29uc3QgeyBSb3V0ZXIsIGpzb24gfSAgICAgID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3QgUmVwb3J0c1JvdXRlciAgICAgICAgID0gUm91dGVyKCk7XG5jb25zdCBqc29uQm9keVBhcnNlciAgICAgICAgPSBqc29uKCk7XG5jb25zdCBwYXRoICAgICAgICAgICAgICAgICAgPSByZXF1aXJlKCdwYXRoJyk7XG5cbi8vIHNlcnZpY2VzXG5jb25zdCBSZXBvcnRzU2VydmljZSAgICAgICAgPSByZXF1aXJlKCcuL3JlcG9ydHMtc2VydmljZScpO1xuY29uc3QgRmFjdHNTZXJ2aWNlICAgICAgICAgID0gcmVxdWlyZSgnLi4vZmFjdHMvZmFjdHMtc2VydmljZScpO1xuY29uc3QgeyBjaGVja1JlcG9ydEV4aXN0cyB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZS9jaGVjay1pZi1leGlzdHMnKTtcblxuLy8gb21pdHRpbmcgYXV0aCBtaWRkbGV3YXJlIGZvciBpbml0aWFsIG12cCByZWxlYXNlXG5cblJlcG9ydHNSb3V0ZXJcbiAgICAucm91dGUoJy8nKVxuICAgIC5nZXQoKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICAgIFJlcG9ydHNTZXJ2aWNlXG4gICAgICAgICAgICAuZ2V0UmVwb3J0cygpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVwb3J0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmpzb24oUmVwb3J0c1NlcnZpY2UucmVtb3ZlRHVwZXNSZWR1Y2UocmVwb3J0KSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChuZXh0KVxuXG4gICAgfSlcbiAgICAucG9zdChqc29uQm9keVBhcnNlciwgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZmFjdF9pZCB9ID0gcmVxLmJvZHk7XG4gICAgICAgIGNvbnN0IG5ld1JlcG9ydCA9IHsgXG4gICAgICAgICAgICBmYWN0X2lkOiBmYWN0X2lkLCBcbiAgICAgICAgICAgIHJlcG9ydF9zdGF0dXM6ICdQcm9jZXNzaW5nJyBcbiAgICAgICAgfTtcblxuICAgICAgICB0cnkgeyBGYWN0c1NlcnZpY2VcbiAgICAgICAgICAgIC5nZXRGYWN0QnlJZChuZXdSZXBvcnQuZmFjdF9pZClcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIFJlcG9ydHNTZXJ2aWNlXG4gICAgICAgICAgICAgICAgICAgICAgICAuaW5zZXJ0UmVwb3J0KG5ld1JlcG9ydClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGNyZWF0ZWRSZXBvcnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0YXR1cygyMDEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubG9jYXRpb24oIChwYXRoLnBvc2l4LmpvaW4ocmVxLm9yaWdpbmFsVXJsKSwgYC9pZC8ke2NyZWF0ZWRSZXBvcnQucmVwb3J0X2lkfWApKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmpzb24oY3JlYXRlZFJlcG9ydClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3RhdHVzKDQwNClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuanNvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBgRmFjdCBkb2Vzbid0IGV4aXN0YFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc1xuICAgICAgICAgICAgICAgICAgICAgICAgLnN0YXR1cyg0MDApXG4gICAgICAgICAgICAgICAgICAgICAgICAuanNvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGBNdXN0IGluY2x1ZGUgZmFjdF9pZCBhcyBpbnRlZ2VyYFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9IGNhdGNoIHsgbmV4dCgpOyB9XG5cbiAgICB9KVxuXG5SZXBvcnRzUm91dGVyXG4gICAgLnJvdXRlKCcvaWQvOnJlcG9ydF9pZCcpXG4gICAgLmFsbChjaGVja1JlcG9ydEV4aXN0cylcbiAgICAuZ2V0KChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgICBjb25zdCByZXBvcnRJZCA9IHJlcS5wYXJhbXMucmVwb3J0X2lkO1xuICAgICAgICBSZXBvcnRzU2VydmljZVxuICAgICAgICAgICAgLmdldFJlcG9ydEJ5SWQocmVwb3J0SWQpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVwb3J0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmpzb24ocmVwb3J0KVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKG5leHQpXG4gICAgfSlcbiAgICAucGF0Y2goanNvbkJvZHlQYXJzZXIsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgICBjb25zdCB7IHJlcG9ydF9zdGF0dXMgfSA9IHJlcS5ib2R5O1xuICAgICAgICBjb25zdCByZXBvcnRUb1VwZGF0ZSA9IHsgcmVwb3J0X3N0YXR1cyB9O1xuICAgICAgICBjb25zdCByZXBvcnRJZCA9IHJlcS5wYXJhbXMucmVwb3J0X2lkO1xuXG4gICAgICAgIHRyeSB7IFJlcG9ydHNTZXJ2aWNlXG4gICAgICAgICAgICAudXBkYXRlUmVwb3J0KFxuICAgICAgICAgICAgICAgIHJlcG9ydElkLFxuICAgICAgICAgICAgICAgIHJlcG9ydFRvVXBkYXRlLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlcG9ydCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMSkuanNvbihyZXBvcnQpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3RhdHVzKDQwMClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5qc29uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogYFJlcXVlc3QgYm9keSBtdXN0IGluY2x1ZGUgcmVwb3J0X3N0YXR1cyAnUHJvY2Vzc2luZycsICdBcHByb3ZlZCcsIG9yICdEZW5pZWQnYFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9IGNhdGNoKGVycikgeyBuZXh0KCk7IH1cblxuICAgIH0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlcG9ydHNSb3V0ZXI7Il19